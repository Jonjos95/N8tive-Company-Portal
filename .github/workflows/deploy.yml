name: Deploy to Hugging Face Spaces

on:
  push:
    branches:
      - main
  workflow_dispatch:  # Allow manual trigger

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      
      - name: Validate HTML files
        run: |
          echo "‚úÖ Validating HTML structure..."
          find . -name "*.html" -not -path "./.git/*" -exec echo "Found: {}" \;
      
      - name: Check for required files
        run: |
          echo "üìÅ Validating project structure..."
          
          # Core files
          REQUIRED=(
            "index.html"
            "products.html"
            "pricing.html"
            "login.html"
            "style.css"
            "script.js"
            "auth.js"
          )
          
          MISSING=0
          for file in "${REQUIRED[@]}"; do
            if [ ! -f "$file" ]; then
              echo "‚ùå Missing: $file"
              MISSING=$((MISSING + 1))
            else
              echo "‚úÖ Found: $file"
            fi
          done
          
          # Components
          if [ ! -d "components" ]; then
            echo "‚ùå Missing: components/ directory"
            MISSING=$((MISSING + 1))
          else
            echo "‚úÖ Found: components/ directory"
            if [ ! -f "components/navbar.js" ]; then
              echo "‚ö†Ô∏è  Warning: components/navbar.js not found"
            fi
            if [ ! -f "components/footer.js" ]; then
              echo "‚ö†Ô∏è  Warning: components/footer.js not found"
            fi
          fi
          
          # Assets
          if [ ! -d "assets/images/tech-logos" ]; then
            echo "‚ö†Ô∏è  Warning: assets/images/tech-logos/ directory not found"
          else
            echo "‚úÖ Found: assets/images/tech-logos/ directory"
          fi
          
          if [ $MISSING -gt 0 ]; then
            echo "‚ùå $MISSING required file(s) missing!"
            exit 1
          fi
          
          echo "‚úÖ All required files present"
      
      - name: Deploy to Hugging Face Spaces
        run: |
          # Hugging Face Spaces auto-deploys from GitHub when connected
          # This workflow validates files are ready before deployment
          HF_USERNAME="${HF_USERNAME:-jjosephdev}"
          HF_SPACE="${HF_SPACE:-n8tive-nexus-portal}"
          
          echo "‚úÖ Push successful - Hugging Face will auto-deploy"
          echo "üîó Space URL: https://huggingface.co/spaces/$HF_USERNAME/$HF_SPACE"
          echo "‚ÑπÔ∏è  If Space is connected to this repo, it will update automatically"
      
      - name: Deployment Status
        run: |
          echo "‚úÖ All checks passed!"
          echo "üì¶ Your site is ready to be served"
          echo "üåê Hugging Face Spaces will automatically update"

